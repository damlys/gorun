image: damlys/gogcp-devcontainer:0.2.0
definitions:
  caches:
    projects-core-terraform-modules-main: projects/core/terraform-modules/main/.terraform
    projects-core-terraform-modules-prod: projects/core/terraform-modules/prod/.terraform
    projects-core-terraform-modules-test: projects/core/terraform-modules/test/.terraform
    projects-core-terraform-submodules-gcp-docker-images-registry: projects/core/terraform-submodules/gcp-docker-images-registry/.terraform
    projects-core-terraform-submodules-gcp-helm-charts-registry: projects/core/terraform-submodules/gcp-helm-charts-registry/.terraform
    projects-core-terraform-submodules-gcp-project: projects/core/terraform-submodules/gcp-project/.terraform
    projects-core-terraform-submodules-gcp-terraform-modules-registry: projects/core/terraform-submodules/gcp-terraform-modules-registry/.terraform
    projects-core-terraform-submodules-gcp-terraform-state-bucket: projects/core/terraform-submodules/gcp-terraform-state-bucket/.terraform
    projects-core-terraform-submodules-gke-gateway-redirect: projects/core/terraform-submodules/gke-gateway-redirect/.terraform
    projects-core-terraform-submodules-gke-gateway-route: projects/core/terraform-submodules/gke-gateway-route/.terraform
    projects-core-terraform-submodules-gke-platform: projects/core/terraform-submodules/gke-platform/.terraform
    projects-core-terraform-submodules-gke-service-account: projects/core/terraform-submodules/gke-service-account/.terraform
    projects-kuard-terraform-modules-kuard: projects/kuard/terraform-modules/kuard/.terraform
    projects-kuard-terraform-submodules-helm-release: projects/kuard/terraform-submodules/helm-release/.terraform
    projects-kuard-terraform-submodules-kuard: projects/kuard/terraform-submodules/kuard/.terraform
    projects-o11y-terraform-modules-test-monitor: projects/o11y/terraform-modules/test-monitor/.terraform
    projects-o11y-terraform-submodules-gcp-availability-monitor: projects/o11y/terraform-submodules/gcp-availability-monitor/.terraform
    projects-o11y-terraform-submodules-gke-lgtm-stack: projects/o11y/terraform-submodules/gke-lgtm-stack/.terraform
    projects-o11y-terraform-submodules-k8s-otel-collectors: projects/o11y/terraform-submodules/k8s-otel-collectors/.terraform
  scripts:
    - &auth |
      set -e
      echo "$GOOGLE_CREDENTIALS" | gcloud auth activate-service-account --key-file="/dev/stdin"
      export GOOGLE_APPLICATION_CREDENTIALS="/tmp/GOOGLE_APPLICATION_CREDENTIALS.json" && echo "$GOOGLE_CREDENTIALS" >"$GOOGLE_APPLICATION_CREDENTIALS"
      gcloud auth configure-docker "europe-central2-docker.pkg.dev"
      gcloud auth print-access-token | helm registry login --username="oauth2accesstoken" --password-stdin "europe-central2-docker.pkg.dev"
  steps:
    - step: &test-projects-core-docker-images-devcontainer
        name: test projects/core/docker-images/devcontainer
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/devcontainer/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image test "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image show "projects/core/docker-images/devcontainer"
    - step: &publish-projects-core-docker-images-devcontainer
        name: publish projects/core/docker-images/devcontainer
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/devcontainer/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image test "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image publish "projects/core/docker-images/devcontainer"
          - ./scripts/docker-image show "projects/core/docker-images/devcontainer"
    - step: &test-projects-core-docker-images-go-rte
        name: test projects/core/docker-images/go-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go-rte"
          - ./scripts/docker-image test "projects/core/docker-images/go-rte"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/go-rte"
          - ./scripts/docker-image show "projects/core/docker-images/go-rte"
    - step: &publish-projects-core-docker-images-go-rte
        name: publish projects/core/docker-images/go-rte
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go-rte"
          - ./scripts/docker-image test "projects/core/docker-images/go-rte"
          - ./scripts/docker-image publish "projects/core/docker-images/go-rte"
          - ./scripts/docker-image show "projects/core/docker-images/go-rte"
    - step: &test-projects-core-docker-images-go-sdk
        name: test projects/core/docker-images/go-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/go-sdk"
          - ./scripts/docker-image pre-publish "projects/core/docker-images/go-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/go-sdk"
    - step: &publish-projects-core-docker-images-go-sdk
        name: publish projects/core/docker-images/go-sdk
        condition:
          changesets:
            includePaths:
              - "projects/core/docker-images/go-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/core/docker-images/go-sdk"
          - ./scripts/docker-image test "projects/core/docker-images/go-sdk"
          - ./scripts/docker-image publish "projects/core/docker-images/go-sdk"
          - ./scripts/docker-image show "projects/core/docker-images/go-sdk"
    - step: &validate-projects-core-terraform-modules-main
        name: validate projects/core/terraform-modules/main
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/main/**"
        caches:
          - projects-core-terraform-modules-main
        script:
          - *auth
          - ./scripts/terraform-module test "projects/core/terraform-modules/main"
    - step: &plan-projects-core-terraform-modules-main
        name: plan projects/core/terraform-modules/main
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/main/**"
        caches:
          - projects-core-terraform-modules-main
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/main" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/main" plan -input="false"
    - step: &apply-projects-core-terraform-modules-main
        name: apply projects/core/terraform-modules/main
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/main/**"
        caches:
          - projects-core-terraform-modules-main
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/main" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/main" apply -input="false" -auto-approve
        trigger: manual
    - step: &validate-projects-core-terraform-modules-prod
        name: validate projects/core/terraform-modules/prod
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/prod/**"
        caches:
          - projects-core-terraform-modules-prod
        script:
          - *auth
          - ./scripts/terraform-module test "projects/core/terraform-modules/prod"
    - step: &plan-projects-core-terraform-modules-prod
        name: plan projects/core/terraform-modules/prod
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/prod/**"
        caches:
          - projects-core-terraform-modules-prod
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/prod" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/prod" plan -input="false"
    - step: &apply-projects-core-terraform-modules-prod
        name: apply projects/core/terraform-modules/prod
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/prod/**"
        caches:
          - projects-core-terraform-modules-prod
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/prod" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/prod" apply -input="false" -auto-approve
        trigger: manual
    - step: &validate-projects-core-terraform-modules-test
        name: validate projects/core/terraform-modules/test
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/test/**"
        caches:
          - projects-core-terraform-modules-test
        script:
          - *auth
          - ./scripts/terraform-module test "projects/core/terraform-modules/test"
    - step: &plan-projects-core-terraform-modules-test
        name: plan projects/core/terraform-modules/test
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/test/**"
        caches:
          - projects-core-terraform-modules-test
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/test" plan -input="false"
    - step: &apply-projects-core-terraform-modules-test
        name: apply projects/core/terraform-modules/test
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-modules/test/**"
        caches:
          - projects-core-terraform-modules-test
        script:
          - *auth
          - terraform -chdir="projects/core/terraform-modules/test" init -input="false"
          - terraform -chdir="projects/core/terraform-modules/test" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-projects-core-terraform-submodules-gcp-docker-images-registry
        name: test projects/core/terraform-submodules/gcp-docker-images-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-docker-images-registry/**"
        caches:
          - projects-core-terraform-submodules-gcp-docker-images-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-docker-images-registry"
    - step: &publish-projects-core-terraform-submodules-gcp-docker-images-registry
        name: publish projects/core/terraform-submodules/gcp-docker-images-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-docker-images-registry/**"
        caches:
          - projects-core-terraform-submodules-gcp-docker-images-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-docker-images-registry"
    - step: &test-projects-core-terraform-submodules-gcp-helm-charts-registry
        name: test projects/core/terraform-submodules/gcp-helm-charts-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-helm-charts-registry/**"
        caches:
          - projects-core-terraform-submodules-gcp-helm-charts-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-helm-charts-registry"
    - step: &publish-projects-core-terraform-submodules-gcp-helm-charts-registry
        name: publish projects/core/terraform-submodules/gcp-helm-charts-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-helm-charts-registry/**"
        caches:
          - projects-core-terraform-submodules-gcp-helm-charts-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-helm-charts-registry"
    - step: &test-projects-core-terraform-submodules-gcp-project
        name: test projects/core/terraform-submodules/gcp-project
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-project/**"
        caches:
          - projects-core-terraform-submodules-gcp-project
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-project"
    - step: &publish-projects-core-terraform-submodules-gcp-project
        name: publish projects/core/terraform-submodules/gcp-project
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-project/**"
        caches:
          - projects-core-terraform-submodules-gcp-project
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-project"
    - step: &test-projects-core-terraform-submodules-gcp-terraform-modules-registry
        name: test projects/core/terraform-submodules/gcp-terraform-modules-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-modules-registry/**"
        caches:
          - projects-core-terraform-submodules-gcp-terraform-modules-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-modules-registry"
    - step: &publish-projects-core-terraform-submodules-gcp-terraform-modules-registry
        name: publish projects/core/terraform-submodules/gcp-terraform-modules-registry
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-modules-registry/**"
        caches:
          - projects-core-terraform-submodules-gcp-terraform-modules-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-modules-registry"
    - step: &test-projects-core-terraform-submodules-gcp-terraform-state-bucket
        name: test projects/core/terraform-submodules/gcp-terraform-state-bucket
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-state-bucket/**"
        caches:
          - projects-core-terraform-submodules-gcp-terraform-state-bucket
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-state-bucket"
    - step: &publish-projects-core-terraform-submodules-gcp-terraform-state-bucket
        name: publish projects/core/terraform-submodules/gcp-terraform-state-bucket
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gcp-terraform-state-bucket/**"
        caches:
          - projects-core-terraform-submodules-gcp-terraform-state-bucket
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gcp-terraform-state-bucket"
    - step: &test-projects-core-terraform-submodules-gke-gateway-redirect
        name: test projects/core/terraform-submodules/gke-gateway-redirect
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-gateway-redirect/**"
        caches:
          - projects-core-terraform-submodules-gke-gateway-redirect
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-gateway-redirect"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-gateway-redirect"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gke-gateway-redirect"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-gateway-redirect"
    - step: &publish-projects-core-terraform-submodules-gke-gateway-redirect
        name: publish projects/core/terraform-submodules/gke-gateway-redirect
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-gateway-redirect/**"
        caches:
          - projects-core-terraform-submodules-gke-gateway-redirect
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-gateway-redirect"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-gateway-redirect"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gke-gateway-redirect"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-gateway-redirect"
    - step: &test-projects-core-terraform-submodules-gke-gateway-route
        name: test projects/core/terraform-submodules/gke-gateway-route
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-gateway-route/**"
        caches:
          - projects-core-terraform-submodules-gke-gateway-route
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-gateway-route"
    - step: &publish-projects-core-terraform-submodules-gke-gateway-route
        name: publish projects/core/terraform-submodules/gke-gateway-route
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-gateway-route/**"
        caches:
          - projects-core-terraform-submodules-gke-gateway-route
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-gateway-route"
    - step: &test-projects-core-terraform-submodules-gke-platform
        name: test projects/core/terraform-submodules/gke-platform
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-platform/**"
        caches:
          - projects-core-terraform-submodules-gke-platform
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-platform"
    - step: &publish-projects-core-terraform-submodules-gke-platform
        name: publish projects/core/terraform-submodules/gke-platform
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-platform/**"
        caches:
          - projects-core-terraform-submodules-gke-platform
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-platform"
    - step: &test-projects-core-terraform-submodules-gke-service-account
        name: test projects/core/terraform-submodules/gke-service-account
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-service-account/**"
        caches:
          - projects-core-terraform-submodules-gke-service-account
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule pre-publish "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-service-account"
    - step: &publish-projects-core-terraform-submodules-gke-service-account
        name: publish projects/core/terraform-submodules/gke-service-account
        condition:
          changesets:
            includePaths:
              - "projects/core/terraform-submodules/gke-service-account/**"
        caches:
          - projects-core-terraform-submodules-gke-service-account
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule test "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule publish "projects/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule show "projects/core/terraform-submodules/gke-service-account"
    - step: &test-projects-kuard-docker-images-kuard
        name: test projects/kuard/docker-images/kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/docker-images/kuard/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/kuard/docker-images/kuard"
          - ./scripts/docker-image test "projects/kuard/docker-images/kuard"
          - ./scripts/docker-image pre-publish "projects/kuard/docker-images/kuard"
          - ./scripts/docker-image show "projects/kuard/docker-images/kuard"
    - step: &publish-projects-kuard-docker-images-kuard
        name: publish projects/kuard/docker-images/kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/docker-images/kuard/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "projects/kuard/docker-images/kuard"
          - ./scripts/docker-image test "projects/kuard/docker-images/kuard"
          - ./scripts/docker-image publish "projects/kuard/docker-images/kuard"
          - ./scripts/docker-image show "projects/kuard/docker-images/kuard"
    - step: &test-projects-kuard-helm-charts-stateful-kuard
        name: test projects/kuard/helm-charts/stateful-kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/helm-charts/stateful-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/kuard/helm-charts/stateful-kuard"
          - ./scripts/helm-chart test "projects/kuard/helm-charts/stateful-kuard"
          - ./scripts/helm-chart pre-publish "projects/kuard/helm-charts/stateful-kuard"
          - ./scripts/helm-chart show "projects/kuard/helm-charts/stateful-kuard"
    - step: &publish-projects-kuard-helm-charts-stateful-kuard
        name: publish projects/kuard/helm-charts/stateful-kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/helm-charts/stateful-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/kuard/helm-charts/stateful-kuard"
          - ./scripts/helm-chart test "projects/kuard/helm-charts/stateful-kuard"
          - ./scripts/helm-chart publish "projects/kuard/helm-charts/stateful-kuard"
          - ./scripts/helm-chart show "projects/kuard/helm-charts/stateful-kuard"
    - step: &test-projects-kuard-helm-charts-stateless-kuard
        name: test projects/kuard/helm-charts/stateless-kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/helm-charts/stateless-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/kuard/helm-charts/stateless-kuard"
          - ./scripts/helm-chart test "projects/kuard/helm-charts/stateless-kuard"
          - ./scripts/helm-chart pre-publish "projects/kuard/helm-charts/stateless-kuard"
          - ./scripts/helm-chart show "projects/kuard/helm-charts/stateless-kuard"
    - step: &publish-projects-kuard-helm-charts-stateless-kuard
        name: publish projects/kuard/helm-charts/stateless-kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/helm-charts/stateless-kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "projects/kuard/helm-charts/stateless-kuard"
          - ./scripts/helm-chart test "projects/kuard/helm-charts/stateless-kuard"
          - ./scripts/helm-chart publish "projects/kuard/helm-charts/stateless-kuard"
          - ./scripts/helm-chart show "projects/kuard/helm-charts/stateless-kuard"
    - step: &validate-projects-kuard-terraform-modules-kuard
        name: validate projects/kuard/terraform-modules/kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/terraform-modules/kuard/**"
        caches:
          - projects-kuard-terraform-modules-kuard
        script:
          - *auth
          - ./scripts/terraform-module test "projects/kuard/terraform-modules/kuard"
    - step: &plan-projects-kuard-terraform-modules-kuard
        name: plan projects/kuard/terraform-modules/kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/terraform-modules/kuard/**"
        caches:
          - projects-kuard-terraform-modules-kuard
        script:
          - *auth
          - terraform -chdir="projects/kuard/terraform-modules/kuard" init -input="false"
          - terraform -chdir="projects/kuard/terraform-modules/kuard" plan -input="false"
    - step: &apply-projects-kuard-terraform-modules-kuard
        name: apply projects/kuard/terraform-modules/kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/terraform-modules/kuard/**"
        caches:
          - projects-kuard-terraform-modules-kuard
        script:
          - *auth
          - terraform -chdir="projects/kuard/terraform-modules/kuard" init -input="false"
          - terraform -chdir="projects/kuard/terraform-modules/kuard" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-projects-kuard-terraform-submodules-helm-release
        name: test projects/kuard/terraform-submodules/helm-release
        condition:
          changesets:
            includePaths:
              - "projects/kuard/terraform-submodules/helm-release/**"
        caches:
          - projects-kuard-terraform-submodules-helm-release
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule test "projects/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule pre-publish "projects/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule show "projects/kuard/terraform-submodules/helm-release"
    - step: &publish-projects-kuard-terraform-submodules-helm-release
        name: publish projects/kuard/terraform-submodules/helm-release
        condition:
          changesets:
            includePaths:
              - "projects/kuard/terraform-submodules/helm-release/**"
        caches:
          - projects-kuard-terraform-submodules-helm-release
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule test "projects/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule publish "projects/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule show "projects/kuard/terraform-submodules/helm-release"
    - step: &test-projects-kuard-terraform-submodules-kuard
        name: test projects/kuard/terraform-submodules/kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/terraform-submodules/kuard/**"
        caches:
          - projects-kuard-terraform-submodules-kuard
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule test "projects/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule pre-publish "projects/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule show "projects/kuard/terraform-submodules/kuard"
    - step: &publish-projects-kuard-terraform-submodules-kuard
        name: publish projects/kuard/terraform-submodules/kuard
        condition:
          changesets:
            includePaths:
              - "projects/kuard/terraform-submodules/kuard/**"
        caches:
          - projects-kuard-terraform-submodules-kuard
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule test "projects/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule publish "projects/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule show "projects/kuard/terraform-submodules/kuard"
    - step: &validate-projects-o11y-terraform-modules-test-monitor
        name: validate projects/o11y/terraform-modules/test-monitor
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-modules/test-monitor/**"
        caches:
          - projects-o11y-terraform-modules-test-monitor
        script:
          - *auth
          - ./scripts/terraform-module test "projects/o11y/terraform-modules/test-monitor"
    - step: &plan-projects-o11y-terraform-modules-test-monitor
        name: plan projects/o11y/terraform-modules/test-monitor
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-modules/test-monitor/**"
        caches:
          - projects-o11y-terraform-modules-test-monitor
        script:
          - *auth
          - terraform -chdir="projects/o11y/terraform-modules/test-monitor" init -input="false"
          - terraform -chdir="projects/o11y/terraform-modules/test-monitor" plan -input="false"
    - step: &apply-projects-o11y-terraform-modules-test-monitor
        name: apply projects/o11y/terraform-modules/test-monitor
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-modules/test-monitor/**"
        caches:
          - projects-o11y-terraform-modules-test-monitor
        script:
          - *auth
          - terraform -chdir="projects/o11y/terraform-modules/test-monitor" init -input="false"
          - terraform -chdir="projects/o11y/terraform-modules/test-monitor" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-projects-o11y-terraform-submodules-gcp-availability-monitor
        name: test projects/o11y/terraform-submodules/gcp-availability-monitor
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gcp-availability-monitor/**"
        caches:
          - projects-o11y-terraform-submodules-gcp-availability-monitor
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule pre-publish "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gcp-availability-monitor"
    - step: &publish-projects-o11y-terraform-submodules-gcp-availability-monitor
        name: publish projects/o11y/terraform-submodules/gcp-availability-monitor
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gcp-availability-monitor/**"
        caches:
          - projects-o11y-terraform-submodules-gcp-availability-monitor
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule publish "projects/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gcp-availability-monitor"
    - step: &test-projects-o11y-terraform-submodules-gke-lgtm-stack
        name: test projects/o11y/terraform-submodules/gke-lgtm-stack
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gke-lgtm-stack/**"
        caches:
          - projects-o11y-terraform-submodules-gke-lgtm-stack
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule pre-publish "projects/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gke-lgtm-stack"
    - step: &publish-projects-o11y-terraform-submodules-gke-lgtm-stack
        name: publish projects/o11y/terraform-submodules/gke-lgtm-stack
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/gke-lgtm-stack/**"
        caches:
          - projects-o11y-terraform-submodules-gke-lgtm-stack
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule publish "projects/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/gke-lgtm-stack"
    - step: &test-projects-o11y-terraform-submodules-k8s-otel-collectors
        name: test projects/o11y/terraform-submodules/k8s-otel-collectors
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/k8s-otel-collectors/**"
        caches:
          - projects-o11y-terraform-submodules-k8s-otel-collectors
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule pre-publish "projects/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/k8s-otel-collectors"
    - step: &publish-projects-o11y-terraform-submodules-k8s-otel-collectors
        name: publish projects/o11y/terraform-submodules/k8s-otel-collectors
        condition:
          changesets:
            includePaths:
              - "projects/o11y/terraform-submodules/k8s-otel-collectors/**"
        caches:
          - projects-o11y-terraform-submodules-k8s-otel-collectors
        script:
          - *auth
          - ./scripts/terraform-submodule build "projects/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule test "projects/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule publish "projects/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule show "projects/o11y/terraform-submodules/k8s-otel-collectors"

pipelines:
  pull-requests:
    "**":
      - parallel:
          - step: *test-projects-core-docker-images-devcontainer
          - step: *test-projects-core-docker-images-go-rte
          - step: *test-projects-core-docker-images-go-sdk
          - step: *validate-projects-core-terraform-modules-main
          - step: *validate-projects-core-terraform-modules-prod
          - step: *validate-projects-core-terraform-modules-test
          - step: *test-projects-core-terraform-submodules-gcp-docker-images-registry
          - step: *test-projects-core-terraform-submodules-gcp-helm-charts-registry
          - step: *test-projects-core-terraform-submodules-gcp-project
          - step: *test-projects-core-terraform-submodules-gcp-terraform-modules-registry
          - step: *test-projects-core-terraform-submodules-gcp-terraform-state-bucket
          - step: *test-projects-core-terraform-submodules-gke-gateway-redirect
          - step: *test-projects-core-terraform-submodules-gke-gateway-route
          - step: *test-projects-core-terraform-submodules-gke-platform
          - step: *test-projects-core-terraform-submodules-gke-service-account
          - step: *test-projects-kuard-docker-images-kuard
          - step: *test-projects-kuard-helm-charts-stateful-kuard
          - step: *test-projects-kuard-helm-charts-stateless-kuard
          - step: *validate-projects-kuard-terraform-modules-kuard
          - step: *test-projects-kuard-terraform-submodules-helm-release
          - step: *test-projects-kuard-terraform-submodules-kuard
          - step: *validate-projects-o11y-terraform-modules-test-monitor
          - step: *test-projects-o11y-terraform-submodules-gcp-availability-monitor
          - step: *test-projects-o11y-terraform-submodules-gke-lgtm-stack
          - step: *test-projects-o11y-terraform-submodules-k8s-otel-collectors
      - parallel:
          - step: *plan-projects-core-terraform-modules-main
          - step: *plan-projects-core-terraform-modules-prod
          - step: *plan-projects-core-terraform-modules-test
          - step: *plan-projects-kuard-terraform-modules-kuard
          - step: *plan-projects-o11y-terraform-modules-test-monitor
  branches:
    main:
      - parallel:
          - step: *publish-projects-core-docker-images-devcontainer
          - step: *publish-projects-core-docker-images-go-rte
          - step: *publish-projects-core-docker-images-go-sdk
          - step: *publish-projects-core-terraform-submodules-gcp-docker-images-registry
          - step: *publish-projects-core-terraform-submodules-gcp-helm-charts-registry
          - step: *publish-projects-core-terraform-submodules-gcp-project
          - step: *publish-projects-core-terraform-submodules-gcp-terraform-modules-registry
          - step: *publish-projects-core-terraform-submodules-gcp-terraform-state-bucket
          - step: *publish-projects-core-terraform-submodules-gke-gateway-redirect
          - step: *publish-projects-core-terraform-submodules-gke-gateway-route
          - step: *publish-projects-core-terraform-submodules-gke-platform
          - step: *publish-projects-core-terraform-submodules-gke-service-account
          - step: *publish-projects-kuard-docker-images-kuard
          - step: *publish-projects-kuard-helm-charts-stateful-kuard
          - step: *publish-projects-kuard-helm-charts-stateless-kuard
          - step: *publish-projects-kuard-terraform-submodules-helm-release
          - step: *publish-projects-kuard-terraform-submodules-kuard
          - step: *publish-projects-o11y-terraform-submodules-gcp-availability-monitor
          - step: *publish-projects-o11y-terraform-submodules-gke-lgtm-stack
          - step: *publish-projects-o11y-terraform-submodules-k8s-otel-collectors
      - parallel:
          - step: *plan-projects-core-terraform-modules-main
          - step: *plan-projects-core-terraform-modules-prod
          - step: *plan-projects-core-terraform-modules-test
          - step: *plan-projects-kuard-terraform-modules-kuard
          - step: *plan-projects-o11y-terraform-modules-test-monitor
      - parallel:
          - step: *apply-projects-core-terraform-modules-main
          - step: *apply-projects-core-terraform-modules-prod
          - step: *apply-projects-core-terraform-modules-test
          - step: *apply-projects-kuard-terraform-modules-kuard
          - step: *apply-projects-o11y-terraform-modules-test-monitor
